## Panorama SLAM
------
### Essential matrix 
$  p = (u,v) $ 
$$ \theta = -u*coef_x+3/2\pi$$
$$ \phi = -v*coef_y+\pi/2$$ p is a feature point in the panoramic image  
$$x = r cos(\phi )cos(\theta ) $$
$$y = -r sin(\phi )$$
$$z = r cos(\phi)sin(\theta)$$
so the 3D point Essential Matrix : 
$$ P_1^{T}EP_2=0$$
$$r_1r_2z_1z_2\bar{P_1^{T}}EP_2=0$$
$$\bar{P_1^{T}}EP_2=0$$
Where  :$\bar{P_n} = r\begin{bmatrix}
cot(\theta_n)\\-tan(\phi_n)/sin(\theta_n)\\1
\end{bmatrix}$
$$E= \hat{t}R$$

-----
在分解本质矩阵的过程中会遇到 4 solutions 的问题；
常见的办法就是判断4个解各自恢复的点的深度，但是对于panoramic image 正确解也会产生负数的深度值。
solution: 
在初始化的过程中只使用前向视角的特征点，在确定了正确解之后再对后面的点进行深度值的恢复；
## Mono-feature Triangular 
$$P_1=M_1P$$
$$P_2=M_2P$$
$M_1 = I $ ,$ M_2 = [R|t]$
跟传统的深度估计不同的是，传统方法中$P_n$是图像坐标构成的，因此$M_n$中包含了相机内参。而在本应用中$P_n$是三维点，因此 $M_n$中不包含内参成分，剩下的求解过程相同，构建方程->SVD->搞定。




